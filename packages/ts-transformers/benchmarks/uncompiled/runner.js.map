{"version":3,"file":"runner.js","sourceRoot":"","sources":["../src/runner.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport type {SimpleItem} from './simple-item.js';\n\nconst queryParams: {\n  [index: string]: string | boolean | number;\n} = document.location.search\n  .slice(1)\n  .split('&')\n  .filter((s) => s)\n  .map((p) => p.split('='))\n  .reduce(\n    (p: {[key: string]: string | boolean}, [k, v]) => (\n      (p[k!] = (() => {\n        try {\n          return JSON.parse(v!);\n        } catch {\n          return v || true;\n        }\n      })()),\n      p\n    ),\n    {}\n  );\n\n// Settings\nconst itemCount = 250;\nconst itemValueCount = 99;\nconst updateCount = 6;\n\nfunction makeItem(prefix: number) {\n  const o: {[index: string]: string} = {};\n  for (let i = 0; i < itemValueCount; i++) {\n    o['value' + i] = prefix + ': ' + i;\n  }\n  return o as SimpleItem;\n}\n\nfunction generateData(count: number) {\n  const data = [];\n  for (let i = 0; i < count; i++) {\n    data.push(makeItem(i));\n  }\n  return data;\n}\n\nconst data = generateData(itemCount);\nconst otherData = generateData(itemCount * 2).slice(itemCount);\n\nexport const runBenchmark = async (\n  renderApp: (data: SimpleItem[]) => Promise<void>\n) => {\n  const container = document.createElement('div');\n  document.body.appendChild(container);\n\n  const destroy = () => {\n    container.innerHTML = '';\n  };\n\n  const benchmark = queryParams['benchmark'];\n  const getTestStartName = (name: string) => `${name}-start`;\n\n  // Named functions are use to run the measurements so that they can be\n  // selected in the DevTools profile flame chart.\n\n  // Initial Render\n  const initialRender = async () => {\n    const test = 'render';\n    if (benchmark === test || !benchmark) {\n      const start = getTestStartName(test);\n      performance.mark(start);\n      await renderApp(data);\n      performance.measure(test, start);\n      destroy();\n    }\n  };\n  await new Promise((r) => setTimeout(r, 100));\n  await initialRender();\n\n  // Update: toggle data\n  const update = async () => {\n    const test = 'update';\n    if (benchmark === test || !benchmark) {\n      await renderApp(data);\n      const start = getTestStartName(test);\n      performance.mark(start);\n      for (let i = 0; i < updateCount; i++) {\n        await renderApp(i % 2 ? otherData : data);\n      }\n      performance.measure(test, start);\n      destroy();\n    }\n  };\n  await update();\n\n  // Log\n  performance.getEntriesByType('measure').forEach((m) => {\n    console.log(`${m.name}: ${m.duration.toFixed(3)}ms`);\n    (window as unknown as {tachometerResult: number}).tachometerResult =\n      m.duration;\n  });\n};\n"]}